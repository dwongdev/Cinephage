# =============================================================================
# Cinephage Docker Compose
# =============================================================================
#
# Quick Start:
#   1. Copy .env.example to .env and edit your settings
#   2. Run: docker compose up -d
#   3. Open: http://localhost:3000
#
# All settings have sensible defaults. Only CINEPHAGE_MEDIA_PATH is required.
#
# To build from source instead of pulling the image:
#   Uncomment "build: ." and comment out "image:" below
# =============================================================================

services:
  cinephage:
    image: ghcr.io/moldytaint/cinephage:latest
    # build: .  # Uncomment to build locally (requires cloning the repo)
    container_name: cinephage
    restart: unless-stopped
    init: true # Use tini to prevent zombie browser processes

    # -------------------------------------------------------------------------
    # USER PERMISSIONS
    # Run as your user to avoid file permission issues
    # Find your IDs with: id -u && id -g
    # Set via: CINEPHAGE_UID and CINEPHAGE_GID in .env
    # -------------------------------------------------------------------------
    user: '${CINEPHAGE_UID:-1000}:${CINEPHAGE_GID:-1000}'

    security_opt:
      - no-new-privileges:true

    # -------------------------------------------------------------------------
    # PORT
    # Default: 3000. Override with CINEPHAGE_PORT in .env
    # -------------------------------------------------------------------------
    ports:
      - '${CINEPHAGE_PORT:-3000}:3000'

    # -------------------------------------------------------------------------
    # VOLUMES
    # -------------------------------------------------------------------------
    volumes:
      - ./config:/config # App data, config, and logs (auto-created)
      - ${CINEPHAGE_MEDIA_PATH:?Set CINEPHAGE_MEDIA_PATH in .env}:/media # Your media library

    # -------------------------------------------------------------------------
    # ENVIRONMENT
    # -------------------------------------------------------------------------
    environment:
      # Required if accessing via IP/hostname other than localhost
      - ORIGIN=${CINEPHAGE_ORIGIN:-http://localhost:3000}
      # Timezone for scheduled tasks (timedatectl list-timezones)
      - TZ=${CINEPHAGE_TZ:-UTC}
